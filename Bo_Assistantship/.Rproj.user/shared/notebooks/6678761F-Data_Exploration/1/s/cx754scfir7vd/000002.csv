"0","# Function for filtering complaints depending on what years and complaints we will "
"0","# later want to visualize"
"0","complaint_filter <- function(complaints,complaint_types,level,years){"
"0","  filtered <- complaints %>%  "
"0","    st_drop_geometry %>% "
"0","    filter(complaint_type %in% complaint_types,"
"0","           year %in% years) %>% "
"0","    group_by(ct2010, boro_name) %>% "
"0","    summarise(n = sum(n))"
"0","  return(filtered)"
"0","}"
"0",""
"0","# Function for creating choropleth maps depending on the filtered data"
"0","complaint_mapping <- function(shapefile,filtered,output_type,years,complaints){"
"0","  "
"0","  if(length(complaints) == length(c(""Air Quality"",""Lead"",""Water Conservation"",""Industrial Waste"","
"0","                ""Sewer"",""Water System"",""Asbestos"",""Hazardous Materials""))){"
"0","    complaints = ""All Complaints"""
"0","  } else {"
"0","    complaints = glue_collapse(complaints,"", "")"
"0","  }"
"0","    ct <- shapefile %>% "
"0","      left_join(filtered,by= c(""ct2010"",""boro_name"")) "
"0","    map <- tm_shape(ct) +"
"0","      tm_fill(""n"",title=""Complaints"",style=""jenks"", palette = ""viridis"", lwd = .01) +"
"0","      tm_layout(main.title = paste0(""NYC Complaints from \n"",complaints),"
"0","                main.title.position = ""center"","
"0","                main.title.size = 1,"
"0","                main.title.fontface = 2"
"0","      )"
"0","    if(output_type == ""map""){"
"0","      return(map)"
"0","    }"
"0","    else if(output_type == ""shape""){"
"0","      return(ct)"
"0","    }"
"0","       "
"0","    "
"0","  }"
