"0",""
"0","complaints <- c(""Air Quality"",""Lead"",""Water Conservation"",""Industrial Waste"","
"0","                ""Sewer"",""Water System"",""Asbestos"",""Hazardous Materials"")"
"0",""
"0","plotComplaints <- function(data,time_frame,n,complaint_type) {"
"0","  plot <- ggplot(data, aes_string(time_frame, n ,fill = complaint_type)) +"
"0","    geom_area() +"
"0","    scale_fill_viridis(discrete = T) +"
"0","    theme_minimal()  +"
"0","    xlab(""2010 to Present"") +"
"0","    scale_y_continuous(label=comma) +"
"0","    ggtitle(deparse(substitute(data)))"
"0","  return(plot)"
"0",""
"0","}"
"0","plotline <- function(data,time_frame,n,complaint_type) {"
"0","  plot <- ggplot(data, aes_string(time_frame, n ,group = complaint_type, color = complaint_type)) +"
"0","    geom_line() +"
"0","    scale_color_viridis(discrete = T) +"
"0","    theme_minimal()  +"
"0","    xlab(""2010 to Present"") +"
"0","    scale_y_continuous(label=comma)+"
"0","    ggtitle(deparse(substitute(data)))"
"0","  return(plot)"
"0","}"
"0",""
"0","save_plots <- function(plot){"
"0","  ggsave(paste0(""../4_Outputs/"",deparse(substitute(plot)),"".jpg""),"
"0","         plot = plot,width = 10, height = 4)"
"0","}"
"0",""
"0","# For all Complaints"
"0","DEP_time_series_all <- DEP_Query %>% "
"0","  group_by(created_date,complaint_type) %>% "
"0","  count() %>% "
"0","  mutate(month = month(created_date),"
"0","         year = year(created_date)) "
"0",""
"0","DEP_monthly_all <- DEP_time_series_all %>% "
"0","  group_by(month,year,complaint_type) %>% "
"0","  summarise(n = sum(n)) %>% "
"0","  mutate(plot_time = ymd(paste0(year,""-"",month,""-1"")),"
"0","         perc = n/sum(n)) %>% "
"0","  filter(complaint_type %in% complaints)"
"1","`summarise()` has grouped output by 'month', 'year'. You can override using the `.groups` argument.
"
"0","DEP_annual_all <- DEP_time_series_all %>% "
"0","  group_by(year,complaint_type) %>% "
"0","  summarise(n = sum(n)) %>% "
"0","  mutate(year = ymd(paste0(year,""-1-1"")),"
"0","         perc = n/sum(n)) %>% "
"0","  filter(complaint_type %in% complaints)"
"1","`summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
"
"0","# Subset of complaints"
"0","DEP_time_series <- DEP_Query %>% "
"0","  filter(complaint_type %in% complaints) %>%"
"0","  group_by(created_date,complaint_type) %>% "
"0","  count() %>% "
"0","  mutate(month = month(created_date),"
"0","         year = year(created_date)) "
"0",""
"0","DEP_monthly <- DEP_time_series %>% "
"0","  group_by(month,year,complaint_type) %>% "
"0","  summarise(n = sum(n)) %>% "
"0","  mutate(plot_time = ymd(paste0(year,""-"",month,""-1"")),"
"0","         perc = n/sum(n))"
"1","`summarise()` has grouped output by 'month', 'year'. You can override using the `.groups` argument.
"
"0","DEP_annual <- DEP_monthly %>% "
"0","  group_by(year,complaint_type) %>% "
"0","  summarise(n = sum(n)) %>% "
"0","  mutate(year = ymd(paste0(year,""-1-1"")),"
"0","         perc = n/sum(n)) "
"1","`summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
"
"0","# Volume Plots"
"0","dep_filtered_annual_plot_volume <-plotComplaints(DEP_annual,""year"",""n"",""complaint_type"")"
"0","save_plots(dep_filtered_annual_plot_volume)"
"0",""
"0","dep_filtered_annual_plot_line_volume <-plotline(DEP_annual,""year"",""n"",""complaint_type"")"
"0","save_plots(dep_filtered_annual_plot_line_volume)"
"0",""
"0","dep_filtered_monthly_plot_volume <-plotComplaints(DEP_monthly,""plot_time"",""n"",""complaint_type"")"
"0","save_plots(dep_filtered_monthly_plot_volume)"
"0",""
"0","dep_filtered_monthly_plot_line_volume <-plotline(DEP_monthly,""plot_time"",""n"",""complaint_type"")"
"0","save_plots(dep_filtered_monthly_plot_line_volume)"
"0",""
"0","# Proportion Plots:"
"0","dep_filtered_annual_plot_perc <-plotComplaints(DEP_annual,""year"",""perc"",""complaint_type"")"
"0","save_plots(dep_filtered_annual_plot_perc)"
"0",""
"0","dep_filtered_monthly_plot_perc <-plotComplaints(DEP_monthly,""plot_time"",""perc"",""complaint_type"")"
"0","save_plots(dep_filtered_monthly_plot_perc)"
"0",""
"0","dep_annual_plot_perc <-plotComplaints(DEP_annual_all,""year"",""perc"",""complaint_type"")"
"0","save_plots(dep_annual_plot_perc)"
"0",""
"0","dep_monthly_plot_perc <-plotComplaints(DEP_monthly_all,""plot_time"",""perc"",""complaint_type"")"
"0","save_plots(dep_monthly_plot_perc)"
"0",""
"0","# Look at all plots:"
"0","dep_filtered_annual_plot_volume"
